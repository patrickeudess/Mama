<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>MAMA+ ‚Äì G√©ovisualisation</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="styles-icons.css" />
    <link rel="stylesheet" href="styles-mobile-nav.css" />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <style>
      #map {
        height: 500px;
        width: 100%;
        border-radius: 0.5rem;
        z-index: 1;
      }
      
      @media screen and (max-width: 768px) {
        #map {
          height: 400px;
        }
      }
      
      .map-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        align-items: center;
      }
      
      .map-controls select,
      .map-controls button {
        padding: 0.625rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        background: #fff;
        font-size: 0.875rem;
        cursor: pointer;
        min-height: 44px;
      }
      
      .map-controls select {
        flex: 1;
        min-width: 150px;
      }
      
      .map-controls button {
        background: #2563eb;
        color: #fff;
        border-color: #2563eb;
        font-weight: 600;
        white-space: nowrap;
      }
      
      .map-controls button:hover {
        background: #1d4ed8;
      }
      
      .map-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
      }
      
      .map-stat-card {
        padding: 1rem;
        background: #fff;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
        text-align: center;
      }
      
      .map-stat-card h3 {
        margin: 0 0 0.5rem 0;
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
      }
      
      .map-stat-card .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1f2933;
      }
      
      .map-stat-card.risk-high .stat-value {
        color: #ef4444;
      }
      
      .map-stat-card.risk-medium .stat-value {
        color: #f59e0b;
      }
      
      .map-stat-card.risk-low .stat-value {
        color: #10b981;
      }
      
      .cluster-popup {
        min-width: 200px;
      }
      
      .cluster-popup h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
        color: #1f2933;
      }
      
      .cluster-popup-stats {
        display: flex;
        gap: 0.75rem;
        font-size: 0.875rem;
      }
      
      .cluster-popup-stats span {
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        background: #f3f4f6;
      }
      
      .cluster-popup-stats .risk-high {
        background: #fee2e2;
        color: #991b1b;
      }
      
      .cluster-popup-stats .risk-medium {
        background: #fef3c7;
        color: #92400e;
      }
      
      .cluster-popup-stats .risk-low {
        background: #d1fae5;
        color: #065f46;
      }
      
      @media screen and (max-width: 768px) {
        .map-controls {
          flex-direction: column;
        }
        
        .map-controls select,
        .map-controls button {
          width: 100%;
        }
        
        .map-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header role="banner" class="tools-header">
      <div class="header-left">
        <a href="index-professionnel.html" style="color: #fff; text-decoration: none; font-size: 1.5rem; margin-right: 0.75rem; display: inline-flex; align-items: center; min-width: 44px; min-height: 44px; justify-content: center; -webkit-tap-highlight-color: transparent;" title="Retour au tableau de bord" id="back-icon-link-geo"></a>
        <span class="header-icon" id="header-geo-icon"></span>
        <h1 style="margin: 0; font-size: 1.125rem; line-height: 1.4;">MAMA+ ‚Äì G√©ovisualisation</h1>
      </div>
      <div id="auth-section" role="navigation">
        <div id="user-info" class="hidden" aria-live="polite">
          <span id="user-name" aria-label="Nom de l'utilisateur"></span>
          <button id="logout-button" type="button" aria-label="Se d√©connecter">D√©connexion</button>
        </div>
      </div>
    </header>

    <main role="main" style="padding: 1.5rem;">
      <!-- Filtres globaux -->
      <section class="card" id="global-filters-section" style="margin-bottom: 1rem; padding: 1rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0;">
        <div style="margin-bottom: 0.75rem;">
          <h3 style="margin: 0; font-size: 1rem; font-weight: 600; color: #1e293b; display: flex; align-items: center; gap: 0.5rem;">
            <span>üîç</span>
            <span>Filtres de contexte</span>
          </h3>
          <p style="margin: 0.25rem 0 0 0; font-size: 0.875rem; color: #64748b;">Filtrez les donn√©es selon votre zone d'intervention</p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
          <label style="display: flex; flex-direction: column; gap: 0.5rem;">
            <span style="font-weight: 500; color: #374151; font-size: 0.875rem;">Pays:</span>
            <select id="global-filter-pays" style="padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; background: white;">
              <option value="all">Tous les pays</option>
            </select>
          </label>
          <label style="display: flex; flex-direction: column; gap: 0.5rem;">
            <span style="font-weight: 500; color: #374151; font-size: 0.875rem;">Ville:</span>
            <select id="global-filter-ville" style="padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; background: white;">
              <option value="all">Toutes les villes</option>
            </select>
          </label>
          <label style="display: flex; flex-direction: column; gap: 0.5rem;">
            <span style="font-weight: 500; color: #374151; font-size: 0.875rem;">Centre de sant√©:</span>
            <select id="global-filter-centre" style="padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; background: white;">
              <option value="all">Tous les centres</option>
            </select>
          </label>
          <label style="display: flex; flex-direction: column; gap: 0.5rem;">
            <span style="font-weight: 500; color: #374151; font-size: 0.875rem;">P√©riode:</span>
            <select id="global-filter-periode" style="padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; background: white;">
              <option value="week">Cette semaine</option>
              <option value="month" selected>Ce mois</option>
              <option value="quarter">Ce trimestre</option>
              <option value="year">Cette ann√©e</option>
              <option value="all">Toutes les p√©riodes</option>
            </select>
          </label>
        </div>
        <div style="display: flex; gap: 0.75rem; align-items: center; justify-content: flex-end; padding-top: 0.75rem; border-top: 1px solid #e2e8f0;">
          <button id="reset-global-filters" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
            üîÑ R√©initialiser
          </button>
          <div id="filter-summary" style="font-size: 0.875rem; color: #64748b; font-style: italic;">
            <span id="filter-summary-text">Aucun filtre actif</span>
          </div>
        </div>
      </section>

      <section class="card" id="map-card">
        <div class="card-header-with-icon">
          <span class="card-icon" id="map-card-icon"></span>
          <h2>G√©ovisualisation des patientes</h2>
        </div>
        
        <!-- Contr√¥les de la carte -->
        <div class="map-controls">
          <select id="filter-ville" aria-label="Filtrer par ville">
            <option value="all">Toutes les villes</option>
          </select>
          <select id="filter-risque" aria-label="Filtrer par niveau de risque">
            <option value="all">Tous les risques</option>
            <option value="√©lev√©">Risque √©lev√©</option>
            <option value="moyen">Risque moyen</option>
            <option value="faible">Risque faible</option>
          </select>
          <button id="reset-map" type="button">R√©initialiser</button>
        </div>
        
        <!-- Carte interactive -->
        <div id="map"></div>
        
        <!-- Statistiques globales -->
        <div class="map-stats" id="map-stats">
          <div class="map-stat-card">
            <h3>Total patientes</h3>
            <div class="stat-value" id="stat-total">0</div>
          </div>
          <div class="map-stat-card risk-high">
            <h3>Risque √©lev√©</h3>
            <div class="stat-value" id="stat-high">0</div>
          </div>
          <div class="map-stat-card risk-medium">
            <h3>Risque moyen</h3>
            <div class="stat-value" id="stat-medium">0</div>
          </div>
          <div class="map-stat-card risk-low">
            <h3>Risque faible</h3>
            <div class="stat-value" id="stat-low">0</div>
          </div>
        </div>
      </section>
    </main>

    <footer role="contentinfo">
      <small>Prototype MAMA+ ‚Äì Am√©lioration du suivi pr√©natal</small>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Scripts de l'application -->
    <script src="utils/icons.js"></script>
    <script src="utils/health-facilities.js"></script>
    <!-- Syst√®me de filtres globaux -->
    <script src="utils/global-filters.js"></script>
    <!-- Am√©liorations du tableau de bord -->
    <script src="utils/dashboard-enhancements.js"></script>
    <script src="app-geovisualisation.js" defer></script>
    <script src="utils/mobile-nav.js" defer></script>
    
    <script>
      // Initialiser les ic√¥nes au chargement
      document.addEventListener('DOMContentLoaded', function() {
        if (window.getIcon) {
          // Header
          const backIconLink = document.querySelector('#back-icon-link-geo');
          if (backIconLink) {
            backIconLink.innerHTML = window.getIcon('back', 24, 'white');
          }
          
          const headerGeoIcon = document.querySelector('#header-geo-icon');
          if (headerGeoIcon) {
            headerGeoIcon.innerHTML = window.getIcon('location', 28, 'white');
          }
          
          // Card icon
          const mapCardIcon = document.querySelector('#map-card-icon');
          if (mapCardIcon) {
            mapCardIcon.innerHTML = window.getIcon('location', 24, '#3b82f6');
          }
        }
      });
    </script>
  </body>
</html>
