<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>MAMA+ – Créer votre profil établissement</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="styles-icons.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .profile-creation-container {
        width: 100%;
        max-width: 700px;
        background: white;
        border-radius: 1.5rem;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        animation: slideUp 0.4s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .profile-header {
        text-align: center;
        margin-bottom: 2.5rem;
      }

      .profile-header-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem auto;
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .profile-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: #1f2933;
        margin-bottom: 0.5rem;
      }

      .profile-header p {
        color: #6b7280;
        font-size: 1rem;
      }

      .form-section {
        margin-bottom: 2rem;
      }

      .form-section h3 {
        color: #3b82f6;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e5e7eb;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }
        .profile-creation-container {
          padding: 2rem 1.5rem;
        }
        .profile-header h1 {
          font-size: 1.75rem;
        }
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1.25rem;
      }

      .form-group label {
        font-weight: 500;
        color: #374151;
        font-size: 0.9rem;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 0.875rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.2s ease;
        background: white;
        color: #1f2933;
        font-family: inherit;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      }

      .form-group input::placeholder {
        color: #9ca3af;
      }

      .form-help-text {
        font-size: 0.8rem;
        color: #6b7280;
        margin-top: -0.25rem;
      }

      .required {
        color: #ef4444;
      }

      .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2.5rem;
        padding-top: 2rem;
        border-top: 2px solid #e5e7eb;
      }

      .btn-primary {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        border-radius: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-secondary {
        padding: 1rem 2rem;
        background: #f3f4f6;
        color: #374151;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-secondary:hover {
        background: #e5e7eb;
      }

      .message {
        padding: 0.875rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.9rem;
        text-align: center;
        margin-top: 1rem;
      }

      .message.error {
        background: #fef2f2;
        color: #dc2626;
        border: 1px solid #fecaca;
      }

      .message.success {
        background: #ecfdf5;
        color: #059669;
        border: 1px solid #a7f3d0;
      }

      .progress-indicator {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
      }

      .progress-step {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #e5e7eb;
        transition: all 0.3s ease;
      }

      .progress-step.active {
        background: #10b981;
        transform: scale(1.2);
      }
    </style>
  </head>
  <body>
    <div class="profile-creation-container">
      <div class="profile-header">
        <div class="profile-header-icon" id="header-icon-container"></div>
        <h1>Créer votre profil établissement</h1>
        <p>Remplissez les informations de votre établissement de santé pour commencer</p>
        <div class="progress-indicator">
          <div class="progress-step active"></div>
          <div class="progress-step"></div>
          <div class="progress-step"></div>
        </div>
      </div>

      <form id="establishment-profile-form">
        <div class="form-section">
          <h3>Informations de l'établissement</h3>
          
          <div class="form-group">
            <label>
              Nom de l'établissement <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="etab-nom" 
              placeholder="Ex: CHU de Cocody" 
              required 
              autocomplete="organization"
            />
            <small class="form-help-text">Le nom officiel de votre établissement de santé</small>
          </div>

          <div class="form-group">
            <label>
              Type d'établissement <span class="required">*</span>
            </label>
            <select id="etab-type" required>
              <option value="">Sélectionner le type...</option>
              <option value="hopital">Hôpital</option>
              <option value="centre_sante">Centre de santé</option>
              <option value="clinique">Clinique</option>
              <option value="dispensaire">Dispensaire</option>
              <option value="csref">Centre de santé de référence (CSREF)</option>
              <option value="csu">Centre de santé urbain (CSU)</option>
            </select>
          </div>

          <div class="form-group">
            <label>
              Adresse complète <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="etab-adresse" 
              placeholder="Adresse complète de l'établissement" 
              required 
              autocomplete="street-address"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>
                Ville <span class="required">*</span>
              </label>
              <input 
                type="text" 
                id="etab-ville" 
                placeholder="Ex: Abidjan" 
                required 
                autocomplete="address-level2"
              />
            </div>
            <div class="form-group">
              <label>
                Pays <span class="required">*</span>
              </label>
              <select id="etab-pays" required>
                <option value="">Choisir un pays...</option>
                <option value="Côte d'Ivoire" selected>Côte d'Ivoire</option>
                <option value="Mali">Mali</option>
                <option value="Burkina Faso">Burkina Faso</option>
                <option value="Sénégal">Sénégal</option>
                <option value="Guinée">Guinée</option>
                <option value="Niger">Niger</option>
                <option value="Bénin">Bénin</option>
                <option value="Togo">Togo</option>
                <option value="Ghana">Ghana</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>
                Téléphone <span class="required">*</span>
              </label>
              <input 
                type="tel" 
                id="etab-telephone" 
                placeholder="Ex: +2250700000000" 
                required 
                autocomplete="tel"
              />
            </div>
            <div class="form-group">
              <label>
                Email
              </label>
              <input 
                type="email" 
                id="etab-email" 
                placeholder="contact@etablissement.ci" 
                autocomplete="email"
              />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Informations du responsable</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>
                Prénom du responsable <span class="required">*</span>
              </label>
              <input 
                type="text" 
                id="etab-resp-prenom" 
                placeholder="Prénom" 
                required 
                autocomplete="given-name"
              />
            </div>
            <div class="form-group">
              <label>
                Nom du responsable <span class="required">*</span>
              </label>
              <input 
                type="text" 
                id="etab-resp-nom" 
                placeholder="Nom" 
                required 
                autocomplete="family-name"
              />
            </div>
          </div>

          <div class="form-group">
            <label>
              Fonction du responsable
            </label>
            <input 
              type="text" 
              id="etab-resp-fonction" 
              placeholder="Ex: Directeur, Administrateur, Responsable médical"
            />
          </div>
        </div>

        <div class="form-actions">
          <button type="button" id="cancel-btn" class="btn-secondary">Annuler</button>
          <button type="submit" class="btn-primary">Créer le profil et continuer</button>
        </div>
        
        <div id="establishment-profile-message" class="message" style="display: none;"></div>
      </form>
    </div>

    <!-- Système d'authentification -->
    <script src="utils/auth.js"></script>
    <script>
      // Protéger la page - vérifier la connexion
      if (!window.protectPage || !window.protectPage('etablissement')) {
        // Redirection en cours
      }
    </script>
    <!-- Système d'icônes -->
    <script src="utils/icons.js"></script>
    <!-- Système de code de synchronisation -->
    <script src="utils/sync-code-etablissement.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        if (window.getIcon) {
          const headerIconContainer = document.querySelector('#header-icon-container');
          if (headerIconContainer) {
            headerIconContainer.innerHTML = window.getIcon('users', 60, '#3b82f6') || window.getIcon('doctor', 60, '#3b82f6');
          }
        }

        // Vérifier si le profil existe déjà
        const ESTABLISHMENT_PROFILE_KEY = 'mama_establishment_profile';
        const existingProfile = localStorage.getItem(ESTABLISHMENT_PROFILE_KEY);
        if (existingProfile) {
          // Rediriger vers le tableau de bord si le profil existe déjà
          window.location.href = 'index-etablissement.html';
          return;
        }

        // Gestion du formulaire
        const form = document.getElementById('establishment-profile-form');
        const cancelBtn = document.getElementById('cancel-btn');
        const messageDiv = document.getElementById('establishment-profile-message');

        cancelBtn.addEventListener('click', () => {
          if (confirm('Êtes-vous sûr de vouloir annuler ? Vous devrez créer un profil pour accéder à l\'application.')) {
            if (window.auth && window.auth.logout) {
              window.auth.logout();
            }
            window.location.href = 'index.html';
          }
        });

        form.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const profile = {
            nom: document.getElementById('etab-nom').value.trim(),
            type: document.getElementById('etab-type').value,
            adresse: document.getElementById('etab-adresse').value.trim(),
            ville: document.getElementById('etab-ville').value.trim(),
            pays: document.getElementById('etab-pays').value,
            telephone: document.getElementById('etab-telephone').value.trim(),
            email: document.getElementById('etab-email').value.trim(),
            responsable: {
              prenom: document.getElementById('etab-resp-prenom').value.trim(),
              nom: document.getElementById('etab-resp-nom').value.trim(),
              fonction: document.getElementById('etab-resp-fonction').value.trim()
            },
            createdAt: new Date().toISOString()
          };

          // Générer un ID unique pour l'établissement
          if (!profile.etablissementId) {
            profile.etablissementId = `etab_${profile.nom.replace(/\s+/g, '_').toLowerCase()}_${Date.now()}`;
          }

          // Générer le code de synchronisation automatiquement
          if (window.generateEstablishmentSyncCode) {
            profile.syncCode = window.generateEstablishmentSyncCode();
            profile.syncCodeCreatedAt = new Date().toISOString();
          } else {
            // Fallback si le script n'est pas chargé
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = 'ETAB-';
            for (let i = 0; i < 4; i++) {
              code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            code += '-';
            for (let i = 0; i < 4; i++) {
              code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            profile.syncCode = code;
            profile.syncCodeCreatedAt = new Date().toISOString();
          }

          try {
            localStorage.setItem(ESTABLISHMENT_PROFILE_KEY, JSON.stringify(profile));
            
            messageDiv.className = 'message success';
            messageDiv.textContent = 'Profil créé avec succès ! Redirection...';
            messageDiv.style.display = 'block';
            
            // Rediriger vers le tableau de bord après 1.5 secondes
            setTimeout(() => {
              window.location.href = 'index-etablissement.html';
            }, 1500);
          } catch (error) {
            messageDiv.className = 'message error';
            messageDiv.textContent = 'Erreur lors de la sauvegarde du profil';
            messageDiv.style.display = 'block';
            console.error('Erreur:', error);
          }
        });
      });
    </script>
  </body>
</html>




